{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/afyadiet/app/admin/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\n\nexport default function AdminDashboard() {\n  const router = useRouter()\n  const [stats, setStats] = useState<any>(null)\n  const [pendingUsers, setPendingUsers] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(\"\")\n  const [activeTab, setActiveTab] = useState<'overview' | 'verifications'>('overview')\n\n  useEffect(() => {\n    const fetchAdminData = async () => {\n      try {\n        // 1. Fetch Stats\n        const statsRes = await fetch('/api/admin/stats')\n        if (statsRes.status === 401 || statsRes.status === 403) {\n          throw new Error(\"Unauthorized: Please log in as an Admin.\")\n        }\n        const statsData = await statsRes.json()\n        setStats(statsData)\n\n        // 2. Fetch Verifications\n        const verifyRes = await fetch('/api/admin/verifications')\n        const verifyData = await verifyRes.json()\n        setPendingUsers(verifyData.pending || [])\n\n      } catch (err: any) {\n        console.error(\"Admin Load Error:\", err)\n        setError(err.message || \"Failed to load admin data\")\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchAdminData()\n  }, [])\n\n  const handleVerify = async (id: number, action: 'approve' | 'reject') => {\n    if(!confirm(`Are you sure you want to ${action}?`)) return\n    \n    await fetch('/api/admin/verifications', {\n      method: 'POST',\n      headers: {'Content-Type': 'application/json'},\n      body: JSON.stringify({ nutritionistId: id, action })\n    })\n    \n    // Refresh List\n    alert(`User ${action}d!`)\n    window.location.reload()\n  }\n\n  if (loading) return <div className=\"p-10 text-center text-lg animate-pulse\">Loading Command Center...</div>\n\n  if (error) return (\n    <div className=\"p-10 text-center\">\n      <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Access Denied</h1>\n      <p className=\"text-gray-700 mb-4\">{error}</p>\n      <button onClick={() => router.push('/login')} className=\"px-4 py-2 bg-blue-600 text-white rounded\">Go to Login</button>\n    </div>\n  )\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Top Bar */}\n      <div className=\"bg-slate-900 text-white p-4 shadow-md sticky top-0 z-10\">\n        <div className=\"container mx-auto flex justify-between items-center\">\n          <h1 className=\"text-xl font-bold flex items-center gap-2\">üõ°Ô∏è AfyaDiet Admin</h1>\n          <div className=\"flex gap-4 text-xs md:text-sm text-gray-400\">\n             <span className=\"flex items-center gap-1\">\n               System: <span className=\"text-green-400 font-bold\">‚óè {stats?.system?.status || 'Active'}</span>\n             </span>\n             <span>Uptime: {Math.floor(stats?.system?.uptime / 60 || 0)}m</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto p-6\">\n        \n        {/* Navigation Tabs */}\n        <div className=\"flex gap-4 mb-8 border-b pb-4\">\n          <button \n            onClick={() => setActiveTab('overview')}\n            className={`px-6 py-2 rounded-full font-bold transition ${activeTab === 'overview' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-600 border hover:bg-gray-100'}`}\n          >\n            üìä System Overview\n          </button>\n          <button \n            onClick={() => setActiveTab('verifications')}\n            className={`px-6 py-2 rounded-full font-bold transition ${activeTab === 'verifications' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-600 border hover:bg-gray-100'}`}\n          >\n            üõ°Ô∏è Verifications \n            {pendingUsers.length > 0 && <span className=\"ml-2 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full\">{pendingUsers.length}</span>}\n          </button>\n        </div>\n\n        {/* --- VIEW 1: OVERVIEW --- */}\n        {activeTab === 'overview' && stats && (\n          <div className=\"space-y-8\">\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-blue-100\">\n                <p className=\"text-gray-500 text-sm font-medium uppercase\">Total Clients</p>\n                <p className=\"text-4xl font-extrabold text-gray-800 mt-2\">{stats.stats?.clients || 0}</p>\n              </div>\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-purple-100\">\n                <p className=\"text-gray-500 text-sm font-medium uppercase\">Nutritionists</p>\n                <p className=\"text-4xl font-extrabold text-gray-800 mt-2\">{stats.stats?.nutritionists || 0}</p>\n              </div>\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-green-100\">\n                <p className=\"text-gray-500 text-sm font-medium uppercase\">Total Revenue</p>\n                <p className=\"text-4xl font-extrabold text-green-600 mt-2\">KSh {(stats.stats?.revenue || 0).toLocaleString()}</p>\n              </div>\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-orange-100\">\n                <p className=\"text-gray-500 text-sm font-medium uppercase\">Pending Actions</p>\n                <p className=\"text-4xl font-extrabold text-orange-500 mt-2\">{stats.stats?.pending || 0}</p>\n              </div>\n            </div>\n\n            {/* Recent Activity Log */}\n            <div className=\"bg-white rounded-xl shadow-sm border overflow-hidden\">\n              <div className=\"bg-gray-50 px-6 py-4 border-b\">\n                <h2 className=\"font-bold text-gray-700\">Live Activity Log</h2>\n              </div>\n              <table className=\"w-full text-left\">\n                <thead className=\"bg-gray-50 text-xs uppercase text-gray-500 border-b\">\n                  <tr>\n                    <th className=\"px-6 py-3\">Time</th>\n                    <th className=\"px-6 py-3\">Action</th>\n                    <th className=\"px-6 py-3\">Details</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y\">\n                  {stats.recentActivity?.map((act: any, i: number) => (\n                    <tr key={i} className=\"hover:bg-gray-50 transition\">\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {new Date(act.created_at).toLocaleDateString()} {new Date(act.created_at).toLocaleTimeString()}\n                      </td>\n                      <td className=\"px-6 py-4 font-medium text-blue-600\">New Booking</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-700\">\n                        <span className=\"font-bold\">{act.client?.name || 'Unknown'}</span> booked a session with <span className=\"font-bold\">{act.nutritionist?.user?.name || 'Unknown'}</span>\n                      </td>\n                    </tr>\n                  ))}\n                  {(!stats.recentActivity || stats.recentActivity.length === 0) && (\n                    <tr><td colSpan={3} className=\"p-8 text-center text-gray-400\">No recent activity found.</td></tr>\n                  )}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* --- VIEW 2: VERIFICATIONS --- */}\n        {activeTab === 'verifications' && (\n          <div className=\"bg-white rounded-xl shadow-sm border p-6\">\n            <h2 className=\"text-xl font-bold mb-6\">Pending Verifications</h2>\n            {pendingUsers.length === 0 ? (\n              <div className=\"text-center py-16 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200\">\n                <div className=\"text-4xl mb-4\">‚úÖ</div>\n                <p className=\"text-gray-500 text-lg font-medium\">All caught up!</p>\n                <p className=\"text-sm text-gray-400\">There are no nutritionists waiting for verification.</p>\n              </div>\n            ) : (\n              <div className=\"grid gap-4\">\n                {pendingUsers.map(user => (\n                  <div key={user.id} className=\"border p-5 rounded-lg flex flex-col md:flex-row justify-between items-center bg-yellow-50/50 hover:bg-yellow-50 transition\">\n                    <div className=\"mb-4 md:mb-0\">\n                      <h3 className=\"font-bold text-lg text-gray-800\">{user.user.name}</h3>\n                      <p className=\"text-sm text-gray-600\">{user.user.email}</p>\n                      <a \n                        href={user.kndi_document_url} \n                        target=\"_blank\" \n                        className=\"inline-flex items-center gap-1 text-blue-600 underline text-sm mt-2 font-medium hover:text-blue-800\"\n                      >\n                        üìÑ View KNDI Document (PDF)\n                      </a>\n                    </div>\n                    <div className=\"flex gap-3\">\n                      <button \n                        onClick={() => handleVerify(user.id, 'reject')} \n                        className=\"bg-white border border-red-200 text-red-600 px-5 py-2 rounded-lg font-bold hover:bg-red-50 transition\"\n                      >\n                        Reject\n                      </button>\n                      <button \n                        onClick={() => handleVerify(user.id, 'approve')} \n                        className=\"bg-green-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-green-700 shadow-sm transition\"\n                      >\n                        Approve\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 643, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/afyadiet/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}