{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/afyadiet/lib/session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { jwtVerify, SignJWT } from \"jose\"\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\n\nexport interface SessionPayload {\n  userId: string\n  email: string\n  role: \"client\" | \"nutritionist\" | \"admin\";\n}\n\nexport async function createSession(payload: SessionPayload): Promise<string> {\n  // ðŸ’¡ FIX: Spread payload into a new object to satisfy Type 'JWTPayload' requirements\n  const token = await new SignJWT({ ...payload })\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setExpirationTime(\"7d\")\n    .sign(JWT_SECRET)\n\n  return token\n}\n\nexport async function verifySession(token: string): Promise<SessionPayload | null> {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET)\n    return verified.payload as unknown as SessionPayload\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function setSessionCookie(token: string) {\n  const cookieStore = await cookies()\n  cookieStore.set(\"session\", token, {\n    httpOnly: true,\n    secure: true,   // Note: This requires HTTPS. If on localhost/http, login might fail.\n    sameSite: \"lax\",\n    maxAge: 7 * 24 * 60 * 60, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function getSessionFromCookie(): Promise<SessionPayload | null> {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"session\")?.value\n\n    if (!token) return null\n\n    return await verifySession(token)\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function clearSessionCookie() {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"session\")\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQ/D,eAAe,cAAc,OAAuB;IACzD,qFAAqF;IACrF,MAAM,QAAQ,MAAM,IAAI,kKAAO,CAAC;QAAE,GAAG,OAAO;IAAC,GAC1C,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,cAAc,KAAa;IAC/C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,sKAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,iBAAiB,KAAa;IAClD,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,WAAW,OAAO;QAChC,UAAU;QACV,QAAQ;QACR,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;QACtB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;QAE1C,IAAI,CAAC,OAAO,OAAO;QAEnB,OAAO,MAAM,cAAc;IAC7B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/afyadiet/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const db =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = db;\n\n// --- THE COMPATIBILITY LAYER ---\n\nexport function getSql() {\n  return async (query: string, params: any[] = []) => {\n    // 1. Convert Postgres syntax ($1, $2, etc) to MySQL syntax (?)\n    let mysqlQuery = query.replace(/\\$\\d+/g, '?');\n\n    // 2. Convert Postgres 'ILIKE' (Case Insensitive) to MySQL 'LIKE' (Default is case insensitive)\n    mysqlQuery = mysqlQuery.replace(/ILIKE/gi, 'LIKE');\n\n    // 3. Remove \"RETURNING *\" statements\n    // MySQL crashes if you try to use RETURNING, so we strip it out.\n    // WARNING: This means INSERT/UPDATE operations won't return the new data immediately.\n    mysqlQuery = mysqlQuery.replace(/RETURNING \\*|RETURNING \\w+/gi, '');\n\n    try {\n      // 4. Execute the raw query using Prisma\n      // Note: We use db.$queryRawUnsafe because we are manually building the query string\n      const result = await db.$queryRawUnsafe(mysqlQuery, ...params);\n      \n      // 5. Ensure we return an array (Prisma sometimes returns objects for metadata)\n      if (Array.isArray(result)) {\n        return result;\n      } \n      \n      // If it's an INSERT/UPDATE result in MySQL, it's not an array of rows.\n      // We return an empty array to prevent the app from crashing when it tries to read result[0].\n      return [];\n      \n    } catch (error) {\n      console.error(\"SQL Adapter Error:\", error);\n      throw error;\n    }\n  };\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AAEC,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;AAI7D,SAAS;IACd,OAAO,OAAO,OAAe,SAAgB,EAAE;QAC7C,+DAA+D;QAC/D,IAAI,aAAa,MAAM,OAAO,CAAC,UAAU;QAEzC,+FAA+F;QAC/F,aAAa,WAAW,OAAO,CAAC,WAAW;QAE3C,qCAAqC;QACrC,iEAAiE;QACjE,sFAAsF;QACtF,aAAa,WAAW,OAAO,CAAC,gCAAgC;QAEhE,IAAI;YACF,wCAAwC;YACxC,oFAAoF;YACpF,MAAM,SAAS,MAAM,GAAG,eAAe,CAAC,eAAe;YAEvD,+EAA+E;YAC/E,IAAI,MAAM,OAAO,CAAC,SAAS;gBACzB,OAAO;YACT;YAEA,uEAAuE;YACvE,6FAA6F;YAC7F,OAAO,EAAE;QAEX,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;YACpC,MAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/afyadiet/app/api/nutritionist/appointments/route.ts"],"sourcesContent":["import { getSessionFromCookie } from \"@/lib/session\"\nimport { getSql } from \"@/lib/db\"\nimport { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getSessionFromCookie()\n    if (!session || session.role !== \"nutritionist\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const searchParams = request.nextUrl.searchParams\n    const status = searchParams.get(\"status\")\n\n    let query = `\n      SELECT a.*, u.full_name as client_name, u.email as client_email\n      FROM appointments a\n      JOIN users u ON a.client_id = u.id\n      WHERE a.nutritionist_id = $1\n    `\n    const params: (string | number)[] = [session.userId]\n\n    if (status) {\n      query += ` AND a.status = $${params.length + 1}`\n      params.push(status)\n    }\n\n    query += ` ORDER BY a.scheduled_at DESC`\n\n    const sql = getSql()\n    const appointments = await sql(query, params)\n    return NextResponse.json({ appointments })\n  } catch (error) {\n    console.error(\"[v0] Appointments fetch error:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const session = await getSessionFromCookie()\n    if (!session || session.role !== \"nutritionist\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const { appointmentId, status } = await request.json()\n\n    if (!appointmentId || !status) {\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 })\n    }\n\n    const sql = getSql()\n    const result = await sql(\n      `UPDATE appointments \n       SET status = $1, updated_at = CURRENT_TIMESTAMP\n       WHERE id = $2 AND nutritionist_id = $3\n       RETURNING *`,\n      [status, appointmentId, session.userId],\n    )\n\n    if (result.length === 0) {\n      return NextResponse.json({ error: \"Appointment not found\" }, { status: 404 })\n    }\n\n    return NextResponse.json({ appointment: result[0] })\n  } catch (error) {\n    console.error(\"[v0] Appointment update error:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,wIAAoB;QAC1C,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,gBAAgB;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,QAAQ,CAAC;;;;;IAKb,CAAC;QACD,MAAM,SAA8B;YAAC,QAAQ,MAAM;SAAC;QAEpD,IAAI,QAAQ;YACV,SAAS,CAAC,iBAAiB,EAAE,OAAO,MAAM,GAAG,GAAG;YAChD,OAAO,IAAI,CAAC;QACd;QAEA,SAAS,CAAC,6BAA6B,CAAC;QAExC,MAAM,MAAM,IAAA,qHAAM;QAClB,MAAM,eAAe,MAAM,IAAI,OAAO;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAa;IAC1C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF;AAEO,eAAe,MAAM,OAAoB;IAC9C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,wIAAoB;QAC1C,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,gBAAgB;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,aAAa,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpD,IAAI,CAAC,iBAAiB,CAAC,QAAQ;YAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,MAAM,IAAA,qHAAM;QAClB,MAAM,SAAS,MAAM,IACnB,CAAC;;;kBAGW,CAAC,EACb;YAAC;YAAQ;YAAe,QAAQ,MAAM;SAAC;QAGzC,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,aAAa,MAAM,CAAC,EAAE;QAAC;IACpD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}